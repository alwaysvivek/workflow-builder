{% extends "layout.html" %}

{% block content %}
<!-- API Key Gate -->
<div id="api-gate" class="gate-container">
    <div class="gate-card">
        <h2>Enter Groq API Key</h2>
        <p>To use this workflow builder, please provide your Groq API Key.</p>

        <div class="form-group">
            <input type="password" id="gate-api-key" placeholder="gsk_..." class="form-control">
            <small class="hint">Get your key from <a href="https://console.groq.com/keys" target="_blank">Groq
                    Console</a></small>
        </div>

        <button id="validate-btn" class="btn primary-btn" onclick="validateKey()">Enter Workflow Builder</button>
        <div id="gate-error" class="error-msg hidden"></div>
    </div>
</div>

<!-- Main Builder UI (Hidden by default) -->
<div id="main-ui" class="builder-container hidden">
    <div class="config-section">
        <h1>Detailed Workflow Builder</h1>

        <div id="templates-section" class="templates-container">
            <h3>Quick Templates</h3>
            <div id="template-buttons" class="template-buttons-grid">
                <!-- Buttons populated by JS -->
            </div>
        </div>

        <div class="form-group">
            <label for="input-text">Input Text <span class="required">*</span></label>
            <textarea id="input-text" rows="6" class="form-control" placeholder="Paste your text here..."></textarea>
        </div>

        <div class="steps-config">
            <div class="step-card">
                <h3>Step 1</h3>
                <select id="step-1" class="form-control action-select" onchange="updateDropdowns()">
                    <option value="" disabled selected>Select Action</option>
                    <option value="clean">Clean</option>
                    <option value="summarize">Summarize</option>
                    <option value="keypoints">Keypoints</option>
                    <option value="simplify">Simplify</option>
                    <option value="analogy">Analogy</option>
                    <option value="classify">Classify</option>
                    <option value="tone">Tone Analysis</option>
                </select>
            </div>

            <div class="step-card">
                <h3>Step 2</h3>
                <select id="step-2" class="form-control action-select" onchange="updateDropdowns()">
                    <option value="" disabled selected>Select Action</option>
                    <!-- Options populated via JS -->
                </select>
            </div>

            <div class="step-card">
                <h3>Step 3</h3>
                <select id="step-3" class="form-control action-select">
                    <option value="" disabled selected>Select Action</option>
                    <!-- Options populated via JS -->
                </select>
            </div>
        </div>

        <button id="run-btn" class="btn primary-btn" onclick="runWorkflow()">Run</button>
        <div id="error-msg" class="error-msg hidden"></div>
    </div>

    <div class="results-section hidden" id="results-area">
        <h2>Run Results</h2>

        <div id="result-step-1" class="result-card hidden">
            <div class="result-header">
                <span class="step-badge">Step 1</span>
                <span class="action-name" id="action-name-1">Action</span>
                <span class="status-indicator running" id="status-1">Running...</span>
            </div>
            <div class="result-content" id="output-1"></div>
        </div>

        <div id="result-step-2" class="result-card hidden">
            <div class="result-header">
                <span class="step-badge">Step 2</span>
                <span class="action-name" id="action-name-2">Action</span>
                <span class="status-indicator waiting" id="status-2">Waiting...</span>
            </div>
            <div class="result-content" id="output-2"></div>
        </div>

        <div id="result-step-3" class="result-card hidden">
            <div class="result-header">
                <span class="step-badge">Step 3</span>
                <span class="action-name" id="action-name-3">Action</span>
                <span class="status-indicator waiting" id="status-3">Waiting...</span>
            </div>
            <div class="result-content" id="output-3"></div>
        </div>
    </div>
</div>
{% endblock %}